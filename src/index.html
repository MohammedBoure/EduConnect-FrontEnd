<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Social Network - Admin Posts</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/css/index.css">
</head>

<body>
    <header>
        <nav id="navBar">
            <ul class="sideBar" id="sideBarNav">
                <li onclick="hideSidebar()"><a href="#"><i class="fas fa-times"></i></a></li>
                <li><a href="index.html"><i class="fas fa-home"></i> HOME</a></li>
                <li><a href="messenger.html"><i class="fas fa-comments"></i> MESSENGER</a></li>
                <li><a href="profile.html"><i class="fas fa-user"></i> PROFILE</a></li>
                <li><a href="posts.html"><i class="fas fa-blog"></i> BLOG</a></li>
                <li class="auth-link" id="sideRegisterLink"><a href="register.html"><i class="fas fa-user-plus"></i>
                        REGISTER</a></li>
                <li class="auth-link" id="sideLoginLink"><a href="login.html"><i class="fas fa-sign-in-alt"></i>
                        LOGIN</a></li>
                <li class="auth-link" id="sideLogoutLink" style="display: none;"><a href="#" onclick="logout()"><i
                            class="fas fa-sign-out-alt"></i> LOGOUT</a></li>
            </ul>
            <ul id="mainNav">
                <li><a href="index.html"><i class="fas fa-home"></i> HOME</a></li>
                <li class="hideOnMobile"><a href="messenger.html"><i class="fas fa-comments"></i> MESSENGER</a></li>
                <li class="hideOnMobile"><a href="profile.html"><i class="fas fa-user"></i> PROFILE</a></li>
                <li class="hideOnMobile"><a href="posts.html"><i class="fas fa-blog"></i> BLOG</a></li>
                <li class="hideOnMobile auth-link" id="registerLink"><a href="register.html"><i
                            class="fas fa-user-plus"></i> REGISTER</a></li>
                <li class="hideOnMobile auth-link" id="loginLink"><a href="login.html"><i
                            class="fas fa-sign-in-alt"></i> LOGIN</a></li>
                <li class="hideOnMobile auth-link" id="logoutLink" style="display: none;"><a href="#"
                        onclick="logout()"><i class="fas fa-sign-out-alt"></i> LOGOUT</a></li>
                <li onclick="showSidebar()"><a href="#"><i class="fas fa-bars"></i></a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="about-section">
            <div class="about-image">
                <img src="/images/MainImage.jpg" alt="University Community">
            </div>
            <div class="about-content">
                <h2>Welcome to Our University Social Network</h2>
                <p>Join a vibrant community of students, faculty, and alumni. Stay connected, share ideas, and stay
                    updated with the latest university announcements. Our platform fosters collaboration, learning, and
                    engagement for everyone in our academic family.</p>
                <a href="aboutUS.html" class="btn-primary">Learn More About Us</a>
            </div>
        </div>

        <div class="section">
            <h2><i class="fas fa-bullhorn"></i> Admin Announcements</h2>
            <div id="adminPosts">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script defer>
        function showSidebar() {
            document.querySelector('.sideBar').style.display = 'flex';
        }

        function hideSidebar() {
            document.querySelector('.sideBar').style.display = 'none';
        }

        function updateNav() {
            const isLoggedIn = isAuthenticated();
            document.getElementById('registerLink').style.display = isLoggedIn ? 'none' : 'block';
            document.getElementById('loginLink').style.display = isLoggedIn ? 'none' : 'block';
            document.getElementById('logoutLink').style.display = isLoggedIn ? 'block' : 'none';
            document.getElementById('sideRegisterLink').style.display = isLoggedIn ? 'none' : 'block';
            document.getElementById('sideLoginLink').style.display = isLoggedIn ? 'none' : 'block';
            document.getElementById('sideLogoutLink').style.display = isLoggedIn ? 'block' : 'none';
        }

        async function loadAdminPosts(page = 1, perPage = 10) {
            const postsDiv = document.getElementById('adminPosts');
            try {
                const result = await apiGetAdminUserPosts(page, perPage);
                if (result.ok) {
                    const { posts, total, pages } = result.data;
                    if (posts.length === 0) {
                        postsDiv.innerHTML = `
                            <div class="no-posts">
                                <i class="fas fa-file-alt"></i>
                                <h3>No Admin Posts Yet</h3>
                                <p>No admin announcements available at this time.</p>
                            </div>
                        `;
                    } else {
                        postsDiv.innerHTML = `
                            <div id="posts-container">
                                <div id="userPosts">
                                    ${posts.map(post => `
                                        <div class="user-post">
                                            ${post.image ? `
                                                <div class="post-image-container">
                                                    <img src="${post.image}" alt="Post Image">
                                                </div>
                                            ` : ''}
                                            <div class="post-content">
                                                <h3><a href="post.html?id=${post.id}">${post.title || 'Untitled'}</a></h3>
                                                <p>${post.content.substring(0, 100)}${post.content.length > 100 ? '...' : ''}</p>
                                                <div class="post-meta">
                                                    <span><i class="fas fa-user"></i> ${post.author.first_name} ${post.author.last_name}</span>
                                                    <span><i class="fas fa-calendar-alt"></i> ${new Date(post.created_at).toLocaleDateString()}</span>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                        if (pages > 1) {
                            postsDiv.innerHTML += `
                                <div class="pagination">
                                    ${page > 1 ? `<button class="btn-primary" onclick="loadAdminPosts(${page - 1}, ${perPage})"><i class="fas fa-chevron-left"></i> Previous</button>` : ''}
                                    <span>Page ${page} of ${pages}</span>
                                    ${page < pages ? `<button class="btn-primary" onclick="loadAdminPosts(${page + 1}, ${perPage})">Next <i class="fas fa-chevron-right"></i></button>` : ''}
                                </div>
                            `;
                        }
                    }
                } else {
                    postsDiv.innerHTML = `<p class="message error"><i class="fas fa-exclamation-circle"></i> ${result.error}</p>`;
                }
            } catch (error) {
                postsDiv.innerHTML = `<p class="message error"><i class="fas fa-exclamation-circle"></i> Error loading posts: ${error.message}</p>`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateNav();
            loadAdminPosts();
        });
    </script>
</body>

</html>