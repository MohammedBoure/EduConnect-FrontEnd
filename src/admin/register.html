<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل مستخدم جديد</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="/admin/css/shared_rules.css">
</head>

<body>
    <div class="container">
        <h1>تسجيل مستخدم جديد</h1>
        <div id="message" class="message" style="display: none;"></div>

        <form id="registerForm">
            <label for="first_name">الاسم الأول:</label>
            <input type="text" id="first_name" name="first_name" required>

            <label for="last_name">الاسم الأخير:</label>
            <input type="text" id="last_name" name="last_name" required>

            <label for="email">البريد الإلكتروني:</label>
            <input type="email" id="email" name="email" required>

            <label for="password">كلمة المرور (8 أحرف على الأقل):</label>
            <input type="password" id="password" name="password" minlength="8" required>

            <label for="department">القسم/التخصص:</label>
            <input type="text" id="department" name="department" required>

            <label for="skills">المهارات (مثال: Java, Python):</label>
            <input type="text" id="skills" name="skills" required>

            <label for="photo">رابط الصورة (اختياري):</label>
            <input type="url" id="photo" name="photo">

            <button type="submit" id="submitBtn">تسجيل</button>
        </form>
        <p>لديك حساب بالفعل؟ <a href="login.html">تسجيل الدخول</a></p>

        <!-- إضافة عنصر النتيجة -->
        <p id="result"></p>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script>
        const form = document.getElementById('registerForm');
        const submitBtn = document.getElementById('submitBtn');
        const messageElement = document.getElementById('message');
        const resultElement = document.getElementById('result');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            messageElement.style.display = 'none';
            resultElement.textContent = '';
            submitBtn.disabled = true;
            submitBtn.textContent = 'جاري التسجيل...';

            const formData = new FormData(form);
            const userData = {};
            formData.forEach((value, key) => {
                userData[key] = value;
            });

            if (!userData.photo) {
                delete userData.photo;
            }

            try {
                const result = await apiRegister(userData);
                console.log('Server response:', result);

                if (result.ok) {
                    const user = result.data;

                    messageElement.style.display = 'block';
                    messageElement.textContent = '✅ تم التسجيل بنجاح! سيتم تحويلك إلى صفحة تسجيل الدخول خلال ثوان...';
                    messageElement.style.color = 'green';

                    resultElement.textContent = `الاسم: ${user.first_name} ${user.last_name}\nالبريد الإلكتروني: ${user.email}`;

                    // إعادة التوجيه بعد 3 ثوانٍ
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 3000);
                } else {
                    messageElement.style.display = 'block';
                    messageElement.textContent = `❌ خطأ: ${result.error}`;
                    messageElement.style.color = 'red';
                }
            } catch (error) {
                messageElement.style.display = 'block';
                messageElement.textContent = `❌ خطأ في الاتصال: ${error.message}`;
                messageElement.style.color = 'red';
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'تسجيل';
        });
    </script>
</body>

</html>